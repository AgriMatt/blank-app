<!doctype>
<html lang="en" ng-app="farmbuild.webmapping.examples">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <link rel="stylesheet" href="../libs/ol/ol.css" type="text/css">
    <link rel="stylesheet" href="../css/controls/layer-switcher/index.css" type="text/css">
    <link rel="stylesheet" href="../css/controls/measure/index.css" type="text/css">
    <link rel="stylesheet" href="../css/controls/snap/index.css" type="text/css">
    <link rel="stylesheet" href="../css/main.css" type="text/css">
    <link rel="stylesheet" href="../css/form.css">
    <link rel="stylesheet" href="../css/modal.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <title>Load Susan's farm example</title>
</head>
<body>

<div ng-controller="MapCtrl">

    <modal ng-show="measuredValue > 0" ng-include="'modal-measure-info.tpl.html'"></modal>
	<modal ng-show="showTreatment" ng-include="'modal-treatment-info.tpl.html'"></modal>
    <modal ng-if="noResult"
           ng-include="'modal-validation-error.tpl.html'"></modal>
    <div class="col-md-4 col-lg-3"
         style="overflow: auto;display: block;height: 100%;padding-top: 10px;padding-bottom: 10px;">
        <paddock-details ng-include="'paddock-details.tpl.html'"></paddock-details>
        <farm-details ng-include="'farm-details.tpl.html'"></farm-details>
    </div>
    <div class="col-md-8 col-lg-9">
        <div id="map" class="map">
            <input type="text" id="locationAutoComplete" class="address-search addon">
            <wrapper>
                <!--<label for="layers" class="farm-layers-label">Edit layer</label>-->
                <select id="layers" class="farm-layers addon" ng-model="selectedLayer" ng-change="selectLayer()">
                    <option value="">Select Edit Layer</option>
                    <option value="farm">Farm</option>
                    <option value="paddocks">Paddocks</option>
                </select>
            </wrapper>
        </div>

        <!--
        Because Google doesn't allow us to directly access their tiles, we need to show google map as a separate layer.
        See Paul Spencer's post on the OL3 mailing list for a more complete explanation.
        https://groups.google.com/d/msgid/ol3-dev/e35d8f2a-9cd7-4109-b812-c4401c11dd31%40googlegroups.com?utm_medium=email&utm_source=footer

        Example of a GMaps map with an ol3 map as control, to give users a Google base map with ol3 content on top.
        http://openlayers.org/en/v3.0.0/examples/google-map.html

        Google does not permit the use of their tiles outside of their API.
        OL2 integrated Google in a way that did not directly contravene this limitation but which was in a grey area.
        The Google integration in OL2 was broken several times by changes in the Google API.
        In particular, synchronization of animated movement of the Google Map with other OL content became impossible.
        The technical burden of supporting direct integration with Google Maps was considered too high for OL3.
        Therefore, it is not possible to seamlessly integrate it with OL3 nor will this likely be supported in the future unless Google allows direct access to their tiles (which seems unlikely).
        The example you quoted shows one possible way of integrating with Google Maps by injecting OL content into the Google Maps API.
        There are some limitations, particularly the problem of synchronizing animations.
        Bing, on the other hand, does allow direct access to their tiles and so the Bing content can be integrated directly into OL3.
        You'll need to research what the limitations are on Bing tiles - there is some level of free use but it is likely that if you are using them at the level you indicate you will exceed the free use.
        -->
        <div id="gmap" class="fill"></div>
        <div id="olmap" class="fill"></div>
    </div>
</div>

<script src="../libs/ol/ol.js" type="text/javascript"></script>
<!--<script src="../../libs/ol/ol.js" type="text/javascript"></script>-->
<script src="../libs/proj4/proj4.js"></script>
<script src="../libs/turf/turf.min.js"></script>

<script src="https://maps.google.com/maps/api/js?v=3&amp;sensor=false&libraries=places"></script>

<script type="text/javascript" src="../libs/farmbuild-core.js"></script>
<script type="text/javascript" src="../libs/farmbuild-farmdata.js"></script>
<script type="text/javascript" src="../libs/farmbuild-webmapping.js"></script>
<script src="../libs/farmbuild-soilsampleimporter.js"></script>



<script type="text/javascript" src="index.js"></script>
<script type="text/javascript" src="treatment.js"></script>
<script type="text/ng-template" id="modal-validation-error.tpl.html">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Validation failed</h3>
            </div>
            <div class="modal-body">
                {{noResult}}
                <br/>
                read <a
                    href="https://github.com/FarmBuild/farmbuild-web-mapping" target="_blank">API documentation</a> for
                more information
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="$parent.$parent.noResult=undefined">Ok</button>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="paddock-details.tpl.html">
    <fieldset ng-show="selectedPaddock.geometry">
        <legend>Paddock information</legend>
        <form-section>
            <form-item class="form-group">
                <label for="selectedPaddockName">Name:</label>
                <input type="text" id="selectedPaddockName" class="form-control"
                       ng-model="selectedPaddock.name"
                       ng-change="onPaddockDetailsChanged()"
                       required
                        />
            </form-item>
            <form-item class="form-group">
                <label for="selectedPaddockArea">Area (hectares):</label>

                <p type="text" id="selectedPaddockArea" class="form-control"
                   ng-bind="selectedPaddock.area | number : 2"
                        ></p>
            </form-item>
			
            <form-item class="form-group">
                <label for="selectedPaddockArea">Treatment status:</label>

                <p type="text" id="selectedPaddockArea" class="form-control"
                   ng-bind="selectedPaddock.treatmentStatus"
                        ></p>
            </form-item>
            <form-item class="form-group">
                <label for="selectedPaddockType">Type:</label>
                <select id="selectedPaddockType" class="form-control" ng-change="onPaddockDetailsChanged()"
                        ng-model="selectedPaddock.type" ng-options="paddockType.name for paddockType in paddockTypes">
                    <option value=""></option>
                </select>
            </form-item>
            <form-item>
                <label for="selectedPaddockType">Group:</label>
                <select name="edit_group_type" id="edit_group_type" style="margin-bottom:10px" class="form-control"
                        ng-change="onPaddockDetailsChanged()" ng-model="selectedPaddock.group"
                        ng-options="paddockGroup.name for paddockGroup in paddockGroups">
                    <option value=""></option>
                </select>
            </form-item>
            <form-item class="form-group">
                <label for="selectedPaddockComment">Comment:</label>
    <textarea id="selectedPaddockComment" class="form-control" ng-change="onPaddockDetailsChanged()"
              ng-model="selectedPaddock.comment"></textarea>
            </form-item>
            <button class="btn btn-primary" ng-click="enableDonutDrawing()" ng-show="farmData.name && !donutDrawing">
                Enable donut drawing
            </button>
            <button class="btn btn-primary" ng-click="disableDonutDrawing()" ng-show="farmData.name && donutDrawing">
                Disable donut drawing
            </button>
            <button class="btn btn-danger" ng-click="removeSelectedPaddock()" ng-show="farmData.name">
                Remove
            </button>
			<button class="btn btn-primary" ng-click="showPaddockTreatmentForm()" ng-show="farmData.name">
                Upload Paddock Treatment
            </button>
            <wrapper ng-show="paddockChanged">
                <button class="btn btn-primary" ng-click="apply()">
                    Apply
                </button>
                <button class="btn btn-default" ng-click="cancel()">
                    Cancel
                </button>
            </wrapper>
            <hr/>
        </form-section>
    </fieldset>

</script>
<script type="text/ng-template" id="farm-details.tpl.html">
    <fieldset>
        <legend>Farm information</legend>
        <form-section>
            <form-item class="form-group">
                <label>Farm name *:</label>
                <input type="text" id="farmName" name="farmName" class="form-control"
                       ng-model="farmData.name"
                       ng-change="onFarmNameChanged()"
                       required>
            </form-item>
            <form-item class="form-group">
                <label>Area in hectares:</label>

                <p class="form-control"
                   ng-bind="farmData.area | number : 2"></p>
            </form-item>
            <form-item class="form-group">
                <label>Date last updated:</label>
          <span class="form-control"
                ng-bind="farmData.dateLastUpdated | date: 'medium'"></span>
            </form-item>

            <wrapper ng-show="farmChanged">
                <button class="btn btn-primary" ng-click="apply()">
                    Apply
                </button>
                <button class="btn btn-default" ng-click="cancel()">
                    Cancel
                </button>
            </wrapper>
            <wrapper ng-show="!farmChanged && selectedLayer === 'farm' && farmData.geometry.coordinates.length>0">
                <button class="btn btn-danger" ng-click="removeFarm()">
                    Remove
                </button>
            </wrapper>
            <hr/>

            <wrapper ng-show="!farmChanged && !paddockChanged">

                <button class="btn btn-primary" ng-click="exportFarmData(farmData)">
                    Export farm data
                </button>

                <button class="btn btn-primary" ng-click="toKml()" ng-show="farmData.name">
                    Export KML
                </button>
                <button class="btn btn-primary" ng-click="toGeoJson()" ng-show="farmData.name">
                    Export GeoJSON
                </button>
                <hr>
            </wrapper>

        </form-section>
    </fieldset>
</script>
<script type="text/ng-template" id="modal-measure-info.tpl.html">
    <div class="modal-dialog absolute">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Measurement completed</h3>
            </div>
            <div class="modal-body">
                <h4>Measured value is: {{measuredValue | number : 2}} {{measuredUnit}}</h4>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="$parent.measuredValue=0">Ok</button>
            </div>
        </div>
    </div>
</script>

<script type="text/ng-template" id="modal-treatment-info.tpl.html">
    <div class="modal-dialog absolute">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Treatment</h3>
            </div>
            <div class="modal-body">
			<form>
				<div class="col-md-12">
                <label id="farmName">Treatment type: </label>
				<select id="treamentType" class="form-control" ng-model="treatment.type" ng-change="filterTreatmentNames(treatment.type)">
                    <option value="">Select Treatment</option>
                    <option value="nutrient">Nutrient</option>
                    <option value="chemical">Chemical</option>
					<option value="effluent">Effluent</option>
					<option value="grazing">Grazing</option>
                </select>
				</div>
			
			<div class="col-md-12">
				 <label id="farmName">Treatment name: </label>
				<select id="treamentName" class="form-control" ng-model="treatment.name" ng-options="tn for tn in treatmentNames;" ng-change="">
				    
				</select>
				</div>
				<div class="col-md-12">
				 <label id="farmName">Date Applied: </label>
		<input type="date" ng-model="treatment.date" class="form-control" />	
		</div>
		
				<div class="col-md-12">
				 <label id="farmName">Rate: </label>
		<input type="number" ng-model="treatment.rate" class="form-control" min="0" />	
		</div>
		
		
				<div class="col-md-12">
				 <label id="farmName">WHP (days): </label>
		<input type="number" ng-model="treatment.whp" class="form-control" min="0" />	
		</div>
		
		<div class="col-md-12">
                <label id="farmName">Weather condition: </label>
				<select id="treamentType" ng-model="treatment.weatherCondition" class="form-control" ng-model="selectedType" ng-change="">
                    <option value="">Select weather condition</option>
                    <option value="nutrient">Windy</option>
                    <option value="chemical">Sunny</option>
					<option value="effluent">Cloudy</option>
					<option value="grazing">Raining</option>
                </select>
				</div>
			
            
      
				</form>
				<div class="clearfix"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" ng-click="addPaddockTreatment(treatment, selectedPaddock)">Ok</button>
            </div>
        </div>
    </div>
</script>
</body>
</html>
